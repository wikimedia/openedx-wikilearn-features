name: Pull Translations via Atlas

on:
  workflow_dispatch:
    inputs:
      repository:
        description: 'Atlas repository'
        required: false
        default: 'eemaanamir/openedx-translations'
        type: string
      revision:
        description: 'Atlas revision/branch'
        required: false
        default: 'release/teak'
        type: string

jobs:
  pull-translations:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install gettext
        run: |
          sudo apt-get update
          sudo apt-get install -y gettext

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install pip-tools
        run: |
          pip install -r requirements/pip-tools.txt

      - name: Install Atlas CLI
        run: |
          pip install openedx-atlas

      - name: Install dependencies
        run: |
          pip-sync requirements/dev.txt

      - name: Pull translations
        run: |
          make OPENEDX_ATLAS_PULL=true OPENEDX_ATLAS_ARGS="--repository=${{ inputs.repository }} --revision=${{ inputs.revision }}" pull_translations
        env:
          OPENEDX_ATLAS_PULL: true

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: "chore: Update translations from Atlas"
          branch: update-translations-${{ github.run_number }}
          title: "Update translations from ${{ inputs.repository }}@${{ inputs.revision }}"
          body: |
            ## Translation Update

            Pulled translations using Atlas with the following parameters:
            - Repository: `${{ inputs.repository }}`
            - Revision: `${{ inputs.revision }}`

            Auto-generated by GitHub Actions workflow.
          labels: translations
